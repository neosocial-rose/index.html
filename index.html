<script>
async function generateDemo() {
  if (typeof state !== "undefined" && state.totalCredits <= 0) {
    openAdModal();
    return;
  }

  const input = document.getElementById("topicInput");
  if (!input || !input.value.trim()) {
    notify("Konu gir.");
    return;
  }

  const prompt = input.value.trim();

  if (typeof state !== "undefined") {
    state.totalCredits -= 1;
    localStorage.setItem("nsr_total_credits", state.totalCredits);
    updateCreditsUI();
  }

  try {
    const r = await fetch("/api/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const data = await r.json();

    document.getElementById("result-text").innerText =
      data?.candidates?.[0]?.content?.parts?.[0]?.text || "Üretim yok";

    document.getElementById("result-box").classList.remove("hidden");

  } catch (e) {
    notify("Sunucu hatası");
  }
}
</script>

